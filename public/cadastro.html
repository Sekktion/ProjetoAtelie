<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title> Atelie - Cadastro </title>
  <link rel="stylesheet" type="text/css" href="_css/style.css">
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <link rel="shortcut icon" href="_imagens/logo.ico" type="image/x-icon">
</head>
<header></header>

<body>
  <div id="principal">
    <!-- DIV COM O CONTEÚDO PRINCIPAL E AS FORMATAÇÕES -->
    <div class="janela-registro">
      <h1>Fazer Cadastro</h1>
      <h2>Dados Pessoais</h2>
      <br>

      <!-- ABAIXO ESTÃO OS FORMS PARA CADASTRO -->

      <form action="/cadastro" method="POST">
        <div class="cadastro_esquerdo">

          <label for="nome"></label>
          <input type="text" name="nome" id="nome" autofocus placeholder="Nome:" required>
          <br>
          <br>
          <label for="nasc"></label>
          <input type="date" name="nasc" id="nasc" placeholder="Data de Nascimento:">
          <br>
          <br>
          <label for="celular"></label>
          <input type="text" name="celular" id="celular" placeholder="Celular (DDD):" required>
          <br>
          <br>
          <label for="senha"></label>
          <input type="password" name="senha" id="senha" placeholder="Senha:" required>

        </div>
        <div class="cadastro_direito">

          <label for="sobrenome"></label>
          <input type="text" name="sobrenome" id="sobrenome" placeholder="Sobrenome:" required>
          <br>
          <br>
          <label for="cpf"></label>
          <input type="text" name="cpf" id="cpf" placeholder="CPF:" required autocomplete="off"
            onkeyup=" mascaraCpf('___.___.___-__', this)">
          <br>
          <br>
          <label for="email"></label>
          <input type="email" name="email" id="email" placeholder="E-mail:" required>
          <br>
          <br>
          <label for="txtcsenha"></label>
          <input type="password" name="txtcsenha" id="txtcsenha" placeholder="Confirmar senha:" required>

          <script>
            function mascaraCpf(mascara, input) {
              const vetMask = mascara.split("")
              const numCpf = input.value.replace(/\D/g, "")
              const cursor = Number(input.selectionStart)
              const tecla = (window.event) ? event.keyCode : event.which

              for (let i = 0; i < numCpf.length; i++) {
                vetMask.splice(vetMask.indexOf("_"), 1, numCpf[i])
              }

              input.value = vetMask.join("")

              if (tecla != 37 && (cursor == 3 || cursor == 7 || cursor == 11)) {
                input.setSelectionRange(cursor + 1, cursor + 1)
              } else {
                input.setSelectionRange(cursor, cursor)
              }

            }

            function mascaraCEP(mascara, input) {
              const vetMask = mascara.split("")
              const numCEP = input.value.replace(/\D/g, "")
              const cursor = Number(input.selectionStart)
              const tecla = (window.event) ? event.keyCode : event.which

              for (let i = 0; i < numCEP.length; i++) {
                vetMask.splice(vetMask.indexOf("_"), 1, numCEP[i])
              }

              input.value = vetMask.join("")

              if (tecla != 37 && cursor == 5) {
                input.setSelectionRange(cursor + 1, cursor + 1)
              } else {
                input.setSelectionRange(cursor, cursor)
              }

            }

            function validar() {
              var senha = form_cadastro.senha.value;
              var txtcsenha = form_cadastro.txtcsenha.value;

              if (senha == "" || senha.length <= 6) {
                alert('Senha deve conter no mínimo 6 dígitos');
                form_cadastro.senha.focus();
                return false;
              }
              if (txtcsenha != senha) {
                alert('As senhas não coincidem')
                form_cadastro.txtcsenha.focus();
                return false;
              }
            }
          </script>
        </div>
        <h2>local de entrega</h2> <!-- DADOS PARA ENTREGA -->
        <div class="cadastro_esquerdo">
          <label for="cep"></label>
          <input id="cep" name="cep" type="text" placeholder="CEP" required onkeyup=" mascaraCEP('_____-___', this)" />
          <br>
          <br>
          <label for="numero"></label>
          <input id="numero" name="numero" type="number" placeholder="Numero" maxlength="4" required />
          <br>
          <br>
          <label for="cidade"></label>
          <input id="cidade" name="cidade" type="text" placeholder="Cidade:" required />
          <br>
          <br>

        </div>
        <div class="cadastro_direito">

          <label for="bairro"></label>
          <input id="bairro" name="bairro" type="text" placeholder="Bairro" required />
          <br>
          <br>
          <label for="rua"></label>
          <input id="rua" name="rua" type="text" placeholder="Rua:" required />
          <br>
          <br>
          <label for="estado"></label>
          <select id="estado" name="estado" class="seletor" required>
            <option value="AC">Acre</option>
            <option value="AL">Alagoas</option>
            <option value="AP">Amapá</option>
            <option value="AM">Amazonas</option>
            <option value="BA">Bahia</option>
            <option value="CE">Ceará</option>
            <option value="DF">Distrito Federal</option>
            <option value="ES">Espírito Santo</option>
            <option value="GO">Goiás</option>
            <option value="MA">Maranhão</option>
            <option value="MT">Mato Grosso</option>
            <option value="MS">Mato Grosso do Sul</option>
            <option value="MG">Minas Gerais</option>
            <option value="PA">Pará</option>
            <option value="PB">Paraíba</option>
            <option value="PR">Paraná</option>
            <option value="PE">Pernambuco</option>
            <option value="PI">Piauí</option>
            <option value="RJ">Rio de Janeiro</option>
            <option value="RN">Rio Grande do Norte</option>
            <option value="RS">Rio Grande do Sul</option>
            <option value="RO">Rondônia</option>
            <option value="RR">Roraima</option>
            <option value="SC">Santa Catarina</option>
            <option value="SP">São Paulo</option>
            <option value="SE">Sergipe</option>
            <option value="TO">Tocantins</option>
          </select>
          <br>
          <br>
        </div>
        <br>
        <label for="complemento"></label>
        <input id="complemento" name="complemento" type="text" placeholder="Complemento:" />
        <br>
        <br>
        <div class="cadastrar-submit">
          <button type="submit" onclick="parar()" id="btnconfirm" value="Submit">
        </div>
      </form>
      <script type="text/javascript">
        //SCRIPT PARA CEP PREENCHER AUTOMATICAMENTE
        $("#cep").focusout(function () {
          $.ajax({
            url: 'https://viacep.com.br/ws/' + $(this).val() + '/json/unicode/',
            dataType: 'json',
            success: function (resposta) {

              $("#rua").val(resposta.logradouro);
              $("#complemento").val(resposta.complemento);
              $("#bairro").val(resposta.bairro);
              $("#cidade").val(resposta.localidade);
              $("#estado").val(resposta.uf);

              $("#numero").focus();
            }
          });
        });
      </script>
      <br>
      <br>
    </div>
    <footer>
      <!-- RODAPÉ COM CONTATOS E COPYRIGHT -->
      <p> Copyright &copy; 2020 / CONTATO: (12) 3456-7890 <br>
        <a href="#"><img src="_imagens/face.png" height="20" width="20"></a>
        <a href="#"><img src="_imagens/insta.png" height="20" width="20"></a></p>
    </footer>
  </div>
</body>
<script>
  // Funcao que envia os dados para a API
  function parar() {
    const btn = document.getElementById('formCadastro')
    btn.addEventListener("submit", (event) => {
      event.preventDefault()
    })
    validar()
  }

  function enviarDados() {
    console.log('A')
    const nome = document.querySelector('#nome')
    const nasc = document.querySelector('#nasc')
    const celular = document.querySelector('#contato')
    const email = document.querySelector('#email')
    const senha = document.querySelector('#senha')
    const sobrenome = document.querySelector('#sobrenome')
    const cpf = document.querySelector('#cpf')
    const cep = document.querySelector('#cep')
    const numeroCasa = document.querySelector('#numero')
    const cidade = document.querySelector('#cidade')
    const bairro = document.querySelector('#bairro')
    const rua = document.querySelector('#rua')
    const estado = document.querySelector('#estado')
    const complemento = document.querySelector('#complemento')

    const dadosCadastro = {
      nome: nome.value,
      sobrenome: sobrenome.value,
      nascimento: nasc.value,
      cpf: cpf.value,
      celular: celular.value,
      email: email.value,
      senha: senha.value,
      cep: cep.value,
      bairro: bairro.value,
      numero: numeroCasa.value,
      rua: rua.value,
      complemento: complemento.value,
      estado: estado.value,
      cidade: cidade.value
    }
    const dadosCadastroString = JSON.stringify(dadosCadastro)
    console.log(dadosCadastroString);
    $.ajax({
      method: "POST",
      url: "http://localhost:3000/cadastro",
      dataType: 'json',
      data: dadosCadastroString,
      contentType: 'application/json',
      error: function (xhr, ajaxOptions, errorThrown) {
        console.log(xhr.responseJSON.errors)
        console.log(errorThrown)
      }
    }).done((response) => {

    })
  }
</script>

</html>
</DOCTYPE>