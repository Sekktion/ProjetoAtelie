<DOCTYPE! html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Página de Upload</title>
    <link rel="stylesheet" type="text/css" href="_css/style.css">
    <link rel="shortcut icon" href="_imagens/logo.ico" type="image/x-icon">
    <script src="_js/upload_info.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

    <script>
        function criarAnuncio() {
            var imagem = document.getElementById('img_up')
            var textoDescricao = document.getElementById('descricao')
            var modeloVestido = document.getElementById('tipovestido')
            var medidaQuadril = document.getElementById('txtquadril')
            var medidaOmbro = document.getElementById('txtombro')
            var medidaCintura = document.getElementById('txtcintura')
            var medidaBusto = document.getElementById('txtbusto')
            var medidaBraco = document.getElementById('txtbraco')
            var medidaManga = document.getElementById('txtmanga')
            var medidaComprimento = document.getElementById('txtcomprimento')
            var emailAnunciante = document.getElementById('emailvendedor')
            var formAnunciar = document.getElementById('formAnunciar')

            formAnunciar.addEventListener('submit', (event) => {
                event.preventDefault()
            })

            var dadosProduto = {
                nome: "claudio",
                description: textoDescricao.value,
                preco: 1000,
                cor: "Preto",
                modelo: modeloVestido.value,
                busto: medidaBusto.value,
                quadril: medidaQuadril.value,
                cintura: medidaCintura.value,
                comprimento: medidaComprimento.value,
                ombro: medidaOmbro.value,
                braco: medidaBraco.value,
                manga: medidaManga.value,
                quantidade: "10",
                email: emailAnunciante.value
            }

            var dadosProdutoString = JSON.stringify(dadosProduto)

            $.ajax({
                method: 'POST',
                url: 'http://localhost:3000/produtos',
                data: dadosProdutoString,
                contentType: 'application/json',
            }).done((response) => {
                enviarFoto(response)
                alert('Anuncio criado com sucesso, você será notificado por email assim que se interessarem!')
                // setTimeout(() => {
                //     window.location.assign('http://localhost:3000/')
                // }, 3000)
            })
        }
        function enviarFoto(produtoCriado) {

            var formImagem = document.getElementById('formAnunciar')

            var data = new FormData(formImagem)
            $.ajax({
                method: 'POST',
                url: 'http://localhost:3000/produto/' + produtoCriado._id + '/foto',
                contentType: false,
                processData: false,
                data: data
            }).done((response) => {
                console.log('nice')
            })
        }
    </script>
</head>
<header>
    <nav class="header-nav">                <!--CABEÇALHO COM O MENUZINHO--> 
        <ul>
            <li><a href="index.html">Home</a></li>
        </ul>
    </nav>
</header>
<body> 
    <div id="principal">
        <h1 class="anuncio_pay">Crie seu anuncio aqui</h1>
        <form name="form_upload" class="upload_form" id="formAnunciar">
            <div class="up">
                <form enctype="multipart/form-data" id="formImagem">
                    <input type='file' name="foto" id="file" accept="image/*" onchange="abrir()"/>
                </form>
                <img value="abrir"id='img_up' src=''>
            </div>
            <div class="cadastro_esquerdo">
                <p>
                    <label for="descrição">Descrição:</label><br>
                    <textarea cols="30" rows="10" id="descricao"></textarea>
                </p>
                <label for="tipovestido">Tipo do vestido:</label>
                <br>
                <select name="tipovestido" id="tipovestido">
                    <option value="evase">Evasê</option>
                    <option value="princesa">Princesa</option>
                    <option value="reto">Reta</option>
                    <option value="semisereia">Semi-Sereia</option>
                    <option value="sereia">Sereia</option>
                </select>
            </div>
            <div class="cadastro_direito">
                <div id="ajuste-medidas-esq1">
                    <p>
                        <label for="txtquadril">Quadril:</label><br>
                        <input type="text" name="txtquadril" id="txtquadril" placeholder="(cm)" >
                    </p>
                    <p>
                        <label for="txtombro">Ombro:</label>
                        <br>
                        <input type="text" name="txtombro" id="txtombro" placeholder="(cm)">
                    </p>
                    <p>
                        <label for="txtcintura">Cintura:</label><br>
                        <input type="text" name="txtcintura" id="txtcintura" placeholder="(cm)" >
                    </p>
                </div>
                <div id="ajuste-medidas-dir1">
                    <p>
                        <label for="txtbusto">Busto:</label><br>
                        <input type="text" name="txtbusto"  id="txtbusto" placeholder="(cm)" >
                    </p>
                    <p>
                        <label for="txtbraco">Braço:</label><br>
                        <input type="text" name="txtbraco" id="txtbraco" placeholder="(cm)" >
                    </p>
                    <p>
                        <label for="txtmanga">Manga:</label><br>
                        <input type="text" name="txtmanga" id="txtmanga" placeholder="(cm)" >
                    </p>
                </div>  
                    
                        <label for="txtcomprimento">Comprimento:</label>
                        <br>
                        <input type="text" name="txtcomprimento" id="txtcomprimento" placeholder="(cm)"> 
                
            </div>
            <br>
            <label for="emailvendedor">E-mail do anunciante:</label><br>
            <input type="email" name="emailvendedor" id="emailvendedor">
            <br>
            <br>
            <input type="submit" value="Anunciar" onclick="criarAnuncio()" name="btnconfirm" id="btnconfirm">
       </form>
    <footer>        <!-- RODAPÉ COM CONTATOS E COPYRIGHT -->
        <p> Copyright &copy; 2020 / CONTATO: (12) 3456-7890<br>
        <a href="#"><img src="_imagens/face.png" height="20" width="20"></a> 
        <a href="#"><img src="_imagens/insta.png" height="20" width="20"></a>
       </p> 
    </footer>
    </div>
</body>
</html>
</DOCTYPE>