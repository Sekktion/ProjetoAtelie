<DOCTYPE! html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Página de Upload</title>
    <link rel="stylesheet" type="text/css" href="_css/style.css">
    <link rel="shortcut icon" href="_imagens/logo.ico" type="image/x-icon">
    <script src="_js/upload_info.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

    <script>
        function criarAnuncio() {
            var imagem = document.getElementById('img_up')
            var textoDescricao = document.getElementById('descricao')
            var modeloVestido = document.getElementById('tipovestido')
            var medidaQuadril = document.getElementById('txtquadril')
            var medidaOmbro = document.getElementById('txtombro')
            var medidaCintura = document.getElementById('txtcintura')
            var medidaBusto = document.getElementById('txtbusto')
            var medidaBraco = document.getElementById('txtbraco')
            var medidaManga = document.getElementById('txtmanga')
            var medidaComprimento = document.getElementById('txtcomprimento')
            var emailAnunciante = document.getElementById('emailvendedor')
            var formAnunciar = document.getElementById('formAnunciar')

            formAnunciar.addEventListener('submit', (event) => {
                event.preventDefault()
            })

            var dadosProduto = {
                nome: "claudio",
                description: textoDescricao.value,
                preco: 1000,
                cor: "Preto",
                modelo: modeloVestido.value,
                busto: medidaBusto.value,
                quadril: medidaQuadril.value,
                cintura: medidaCintura.value,
                comprimento: medidaComprimento.value,
                ombro: medidaOmbro.value,
                braco: medidaBraco.value,
                manga: medidaManga.value,
                quantidade: "10",
                email: emailAnunciante.value
            }

            var dadosProdutoString = JSON.stringify(dadosProduto)

            $.ajax({
                method: 'POST',
                url: 'http://localhost:3000/produtos',
                data: dadosProdutoString,
                contentType: 'application/json',
            }).done((response) => {
                enviarFoto(response)
                alert('Anuncio criado com sucesso, você será notificado por email assim que se interessarem!')
                // setTimeout(() => {
                //     window.location.assign('http://localhost:3000/')
                // }, 3000)
            })
        }
        function enviarFoto(produtoCriado) {

            var formImagem = document.getElementById('formAnunciar')

            var data = new FormData(formImagem)
            $.ajax({
                method: 'POST',
                url: 'http://localhost:3000/produto/' + produtoCriado._id + '/foto',
                contentType: false,
                processData: false,
                data: data
            }).done((response) => {
                console.log('nice')
            })
        }
    </script>
</head>
<header>
    <nav class="header-nav">                <!--CABEÇALHO COM O MENUZINHO--> 
        <ul>
            <li><a href="index.html">Home</a></li>
        </ul>
    </nav>
</header>
<body> 
    <div id="principal">



        <h1 class="anuncio_pay">
            Crie seu anuncio aqui
        </h1>              <!--PARTE CENTRAL DO ANUNCIO--> 



        <form name="form_upload" id="formAnunciar">
            <div class="up_file">
                <form enctype="multipart/form-data" id="formImagem">
                    <input  type='file' name="foto" id="file" accept="image/*" onchange="abrir()"/>
                </form>
                <img value="abrir"id='img_up' src=''>
            </div>

            <div class="upload_info_esquerdo">
                <div class="title_lados">
                    dados:
                </div>
                <p>
                    <label for="modelo">Tipo do vestido:</label>
                    <br>
                       <select style="width:150px; height: 35px;border-image: url(../public/_imagens/traco.png);border-image-slice: 6;text-transform: uppercase;font-family: Roboto;font-size: 15;color: #4a413c;"name="modelo" id="modelo" required>
                           <option value="selectEvase">Evasê</option>
                           <option value="selectPrincesa">Princesa</option>
                           <option value="selectReta">Reta</option>
                           <option value="selectSemi">Semi-Sereia</option>
                           <option value="selectSereia">Sereia</option>
                       </select>
                    </p>

                <div class="upload_info_esquerda_1_1">
                    <p>
                    <label for="description">Descricao:</label>
                    <br>
                    <textarea name="description" id="description"required autocomplete="off"></textarea>
                    </p>

                    <p>
                        <label for="quantidade">Quantidade:</label>
                        <br>
                        <input type="number" name="quantidade" id="quantidade" placeholder="Ex: 2" required autocomplete="off">
                    </p>
                </div>


                <div class="upload_info_direita_1_1">
                    <p>
                        <label for="nome">Nome Produto:</label>
                        <br>
                        <input type="text" name="nome" id="nome" placeholder="ex: vestido toptop" required autocomplete="off">
                    </p>
                    <p>
                        <label for="preco">Preco:</label>
                        <br>
                        <input type="text" name="preco" id="preco" placeholder="R$:1000,00"required autocomplete="off">
                    </p>
                    <p>
                        <label for="cor">Cor:</label>
                        <br>
                        <input type="text" name="cor" id="cor" placeholder="Ex: vermelho" required autocomplete="off">
                    </p>
                </div>
<script>
    var preco = form_upload.preco.value;
    var nome = form_upload.nome.value;
    if(nome==""){
        alert('Preencha o campo nome')
        form_upload.nome.focus();
        return false;   
    }
    if(preco==""||preco<0){
        alert('Esse preço não parece justo')
        form_upload.preco.focus();
        return false;   
    }
</script>
            </div>

            <div class="upload_info_direiro">
                <div class="title_lados">
                    Medidas:
                </div>
                <p>
                    <label for="comprimento">comprimento:</label>
                    <br>
                    <input type="text" name="comprimento" id="comprimento" placeholder="(cm)"required autocomplete="off">
                </p>
                <div class="upload_info_esquerda_1">
                    <p>
                        <label for="quadril">Quadril:</label><br>
                        <input type="text" name="quadril" id="quadril" placeholder="(cm)"required autocomplete="off">
                    </p>
                    <p>
                        <label for="ombro">Ombro:</label>
                        <br>
                        <input type="text" name="ombro" id="ombro" placeholder="(cm)"required autocomplete="off">
                    </p>
                    <p>
                        <label for="cintura">Cintura:</label><br>
                        <input type="text" name="cintura" id="cintura" placeholder="(cm)" required autocomplete="off">
                    </p>
                </div>


                <div class="upload_info_direita_1">
                    <p>
                        <label for="busto">Busto:</label><br>
                        <input type="text" name="busto"  id="busto" placeholder="(cm)"required autocomplete="off">
                    </p>
                    <p>
                        <label for="braco">Braco:</label><br>
                        <input type="text" name="braco" id="braco" placeholder="(cm)"required autocomplete="off">
                    </p>
                    <p>
                        <label for="manga">Manga:</label><br>
                        <input type="text" name="manga" id="manga" placeholder="(cm)" required autocomplete="off">
                    </p> 
                    
                </div>


            </div>

            <div class="upload_info_meio">
                
            <p>
                <label for="email">E-mail do Vendedor:</label>
                <br>
                <input type="text" name="email" id="email" placeholder="@gmail.com" required autocomplete="off">
            </p>
            <p>
                <input type="submit" value="Anunciar" onclick="criarAnuncio()" name="btnconfirm" id="btnconfirm">
        </p>
        </div>
       </form>
    <footer>        <!-- RODAPÉ COM CONTATOS E COPYRIGHT -->
        <p> Copyright &copy; 2020 / CONTATO: (12) 3456-7890<br>
        <a href="#"><img src="_imagens/face.png" height="20" width="20"></a> 
        <a href="#"><img src="_imagens/insta.png" height="20" width="20"></a>
       </p> 
    </footer>
    </div>
</body>
</html>
</DOCTYPE>